<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>看診提醒💌</title>
<link rel="manifest" href="manifest.json">	
<link href="static/img/icon_192.png" rel="shortcut icon">

<link rel="Bookmark" href="static/img/favicon.ico"/>
    
<link rel="icon" sizes="192x192" href="static/img/icon_192.png">
<link rel="icon" sizes="128x128" href="static/img/icon_128.png">
<link rel="apple-touch-icon" sizes="128x128" href="static/img/icon_128.png">
<link rel="apple-touch-icon-precomposed" sizes="128x128" href="static/img/icon_128.png">

</head>
    <script>
    // 支援serviceWorker才存入sw.js檔
    if('serviceWorker' in navigator) {
      
      // window load後才執行，以免增加頁面讀取的時間
      window.addEventListener('load', function() {
        
        // 建立sw.js
        navigator.serviceWorker.register('https://hosp-nckm.github.io/web/notice/sw.js')
          .then(function(reg) {
            console.log(reg.scope); // 看這支sw.js執行的範圍
          })
          // 註冊失敗
          .catch(function(err) {
            console.log('error: ', err);
          });
       
        // 附上刪除sw.js的寫法
        /*navigator.serviceWorker.getRegistrations().then(function(reg) {
          for(var reg of reg) {
            reg.unregister()
          }
        });*/
        
      });
    }
  </script>
<!--script>
this.addEventListener('fetch', function(event) {
  event.respondWith(
    caches.match(event.request).then(function (response) {
		  return response;
    })
  );
}); 
</script-->
<script>
    self.addEventListener('fetch', event => {
	const dataUrl = 'https://hosp-nckm.github.io/web/notice/';
	event.respondWith(
		caches.match(event.request).then(function (response) {
			return response || fetch(event.request).then(res =>
				// 存 caches 之前，要先打開 caches.open(dataCacheName)
				caches.open(dataCacheName)
				.then(function(cache) {
					// cache.put(key, value)
					// 下一次 caches.match 會對應到 event.request
					cache.put(event.request, res.clone());
					return res;
				})
			);
		})
	);
}); 
</script>
<script>
	// 查看使用者許可權
	if(Notification.permission === 'granted'){
		console.log('使用者允許通知');
	}else if(Notification.permission === 'denied'){
		console.log('使用者拒絕通知');
	}else{
		console.log('使用者還沒選擇，去向使用者申請許可權吧');
	}
	
	// 請求許可權
	Notification.requestPermission().then(function(permission) {
	if(permission === 'granted'){
		console.log('使用者允許通知');
	}else if(permission === 'denied'){
		console.log('使用者拒絕通知');
	}
	});
	
	// 推送通知
	var notification = new Notification(title, options)
	// 通知訊息
	var n = new Notification('狀態更新提醒',{
		body: '你的朋友圈有3條新狀態，快去檢視吧',
		tag: 'linxin',
		icon: 'https://codertw.com/wp-content/uploads/2018/05/20180527144122-5b0ac39228361.jpg',
		requireInteraction: true
	})
	
	// 關閉通知
	var n = new Notification('狀態更新提醒',{
		body: '你的朋友圈有3條新狀態，快去檢視吧'
	})
	setTimeout(function() {
		n.close();
	}, 3000);
	
</script>
<body>
    <h1>看診提醒</h1>
    <p>看診提醒通知</p>
  
</body>
</html>
